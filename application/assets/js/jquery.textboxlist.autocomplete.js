(function(){TextboxList.Autocomplete=function(D,s){var k,x,f,p,C,d=[],u=[],j=false,t,h,z,e,o;var g=$.extend(true,{minLength:1,maxResults:10,insensitive:true,highlight:true,highlightSelector:null,mouseInteraction:true,onlyFromValues:false,method:"standard",placeholder:"Type to receive suggestions"},s);var y=function(){D.addEvent("bitEditableAdd",B).addEvent("bitEditableFocus",m).addEvent("bitEditableBlur",n).setOptions({bitsOptions:{editable:{addKeys:false,stopEnter:false}}});if($.browser.msie){D.setOptions({bitsOptions:{editable:{addOnBlur:false}}})}if(D.getOptions().unique){k=[];D.addEvent("bitBoxRemove",function(G){if(G.autoValue&&$.inArray(G.autoValue,k)!=-1){k=k.splice($.inArray(G.autoValue,k)+1,1)}},true)}x=D.getOptions().prefix+"-autocomplete";f=TextboxList.Autocomplete.Methods[g.method];p=$('<div class="'+x+'" />').width(D.getContainer().width()).appendTo(D.getContainer());if(b(g.placeholder)){j=$('<div class="'+x+'-placeholder" />').html(g.placeholder).appendTo(p)}C=$('<ul class="'+x+'-results" />').appendTo(p).click(function(G){G.stopPropagation();G.preventDefault()})};var B=function(G){G.toElement().keydown(A).keyup(function(){m()})};var m=function(H){if(H){h=H}if(!d.length){return}var G=h.getValue()[1];if(G.length<g.minLength){F()}if(G==o){return}o=G;C.css("display","none");if(G.length<g.minLength){return}r(G)};var r=function(H){var G=f.filter(d,H,g.insensitive,g.maxResults);if(k){G=$.grep(G,function(I){return $.inArray(I,k)==-1})}l();if(!G.length){return}w();C.empty().css("display","block");$.each(G,function(I,J){c(J,H)});if(g.onlyFromValues){v()}G=G};var c=function(H,I){var G=$('<li class="'+x+'-result" />').html(H[3]?H[3]:H[1]).data("textboxlist:auto:value",H);G.appendTo(C);if(g.highlight){$(g.highlightSelector?G.find(g.highlightSelector):G).each(function(){if($(this).html()){f.highlight($(this),I,g.insensitive,x+"-highlight")}})}if(g.mouseInteraction){G.css("cursor","pointer").hover(function(){q(G)}).mousedown(function(J){J.stopPropagation();J.preventDefault();clearTimeout(z);e=true}).mouseup(function(){if(e){E();h.focus();m();e=false}});if(!g.onlyFromValues){G.mouseleave(function(){if(t&&(t.get(0)==G.get(0))){w()}})}}};var n=function(){z=setTimeout(function(){l();C.css("display","none");o=null},$.browser.msie?150:0)};var F=function(){if(j){j.css("display","block")}};var l=function(){if(j){j.css("display","none")}};var q=function(G){if(!G||!G.length){return}w();t=G.addClass(x+"-result-focus")};var w=function(){if(t&&t.length){t.removeClass(x+"-result-focus");t=null}};var v=function(){return q(C.find(":first"))};var i=function(G){if(!t||!t.length){return self}return q(t[G]())};var E=function(){var H=t.data("textboxlist:auto:value");var G=D.create("box",H.slice(0,3));if(G){G.autoValue=H;k.push(H);h.setValue([null,"",null]);G.inject(h.toElement(),"before")}w();return self};var A=function(I){var H=function(){I.stopPropagation();I.preventDefault()};switch(I.which){case 38:H();(!g.onlyFromValues&&t&&t.get(0)===C.find(":first").get(0))?w():i("prev");break;case 40:H();(t&&t.length)?i("next"):v();break;case 13:H();if(t&&t.length){E()}else{if(!g.onlyFromValues){var J=h.getValue();var G=D.create("box",J);if(G){G.inject(h.toElement(),"before");h.setValue([null,"",null])}}}}};this.setValues=function(G){d=G};y()};TextboxList.Autocomplete.Methods={standard:{filter:function(e,g,d,c){var j=[],h=new RegExp("\\b"+a(g),d?"i":"");for(var f=0;f<e.length;f++){if(j.length===c){break}if(h.test(e[f][1])){j.push(e[f])}}return j},highlight:function(f,e,d,c){var g=new RegExp("(<[^>]*>)|(\\b"+a(e)+")",d?"ig":"g");return f.html(f.html().replace(g,function(i,h,j){return(i.charAt(0)=="<")?i:'<strong class="'+c+'">'+j+"</strong>"}))}}};var b=function(c){return !!(c||c===0)};var a=function(c){return c.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}})();